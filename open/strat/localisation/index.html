<!doctype html>
<!--
	Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
	Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
	Free for personal and commercial use under the MIT license
	https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
	<head>
		<meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Localisation | Transcendence</title>
<meta name="description" content="We have came up with a method for finding the position and orientation of the robot using purely the camera, which we also use to be able to face “straight” forward.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Transcendence">
<meta property="og:title" content="Localisation">
<meta property="og:url" content="https://bozo.infocommsociety.com/open/strat/localisation/">


  <meta property="og:description" content="We have came up with a method for finding the position and orientation of the robot using purely the camera, which we also use to be able to face “straight” forward.">







  <meta property="article:published_time" content="2020-05-02T08:00:00+08:00">



  <meta property="article:modified_time" content="2021-06-03T11:06:44+08:00">




<link rel="canonical" href="https://bozo.infocommsociety.com/open/strat/localisation/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://bozo.infocommsociety.com/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Transcendence Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


		<!-- start custom head snippets -->











<style>
    ul.visible-links li.masthead__menu-item a[href="/open/intro/"]:before {
        transform: scaleX(1);
    }

    ul.hidden-links li.masthead__menu-item a[href="/open/intro/"] {
        color: #fff;
        background: #0092ca;
    }
</style>





<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" href="/assets/images/eagle ver 2.1.3.1-lowres.jpg">

<!-- end custom head snippets -->
	</head>

	<body class="layout--single">
		<nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

		<!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

		

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img loading="lazy" src="/assets/images/eagle%20ver%202.1.3.1-transparent-lowres.png" alt="Transcendence"></a>
        
        <a class="site-title" href="/">
          Transcendence
          <span class="site-subtitle">The fine line between innovation and insanity</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/open/intro/">Open</a>
            </li><li class="masthead__menu-item">
              <a href="/lightweight/intro/">Lightweight</a>
            </li><li class="masthead__menu-item">
              <a href="/rescue/intro/">Rescue</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/contact/">Contact</a>
            </li><li class="masthead__menu-item">
              <a href="/resources/">Resources</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


		<div class="initial-content">
			



<div id="main" role="main">
	
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/open/intro/"><span class="nav__sub-title">Introduction</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/open/mech/"><span class="nav__sub-title">Mechanical</span></a>
        

        
        <ul>
          
            <li><a href="/open/mech/general/">General Info</a></li>
          
            <li><a href="/open/mech/drive/">Drive System</a></li>
          
            <li><a href="/open/mech/mirror/">Mirror</a></li>
          
            <li><a href="/open/mech/dribbler/">Dribbler</a></li>
          
            <li><a href="/open/mech/assorted/">Assorted Parts</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/elec/"><span class="nav__sub-title">Electronics</span></a>
        

        
        <ul>
          
            <li><a href="/open/elec/design/">Design</a></li>
          
            <li><a href="/open/elec/selection/">Selection Process</a></li>
          
            <li><a href="/open/elec/components/">Components</a></li>
          
            <li><a href="/open/elec/circuits/">Circuits</a></li>
          
            <li><a href="/open/elec/history/">History</a></li>
          
            <li><a href="/open/elec/soldering/">Soldering</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/cam/"><span class="nav__sub-title">Camera</span></a>
        

        
        <ul>
          
            <li><a href="/open/cam/general/">General Info</a></li>
          
            <li><a href="/open/cam/track/">Tracking Algorithm</a></li>
          
            <li><a href="/open/cam/gui/">GUI</a></li>
          
            <li><a href="/open/cam/communication/">Communication</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/strat/"><span class="nav__sub-title">Strategy</span></a>
        

        
        <ul>
          
            <li><a href="/open/strat/attack/">Attack Strategy</a></li>
          
            <li><a href="/open/strat/defence/">Defence Strategy</a></li>
          
            <li><a href="/open/strat/localisation/" class="active">Localisation</a></li>
          
            <li><a href="/open/strat/line/">Line Control</a></li>
          
            <li><a href="/open/strat/state/">State Switching</a></li>
          
            <li><a href="/open/strat/simluation/">Simulation</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/debug/"><span class="nav__sub-title">Debugging</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/open/afi/"><span class="nav__sub-title">AFI</span></a>
        

        
      </li>
    
  </ul>
</nav>

    
  
  </div>



	<article class="page" itemscope itemtype="https://schema.org/CreativeWork">
		<meta itemprop="headline" content="Localisation">
		<meta itemprop="description" content="We have came up with a method for finding the position and orientation of the robot using purely the camera, which we also use to be able to face “straight” forward.">
		<meta itemprop="datePublished" content="2020-05-02T08:00:00+08:00">
		<meta itemprop="dateModified" content="2021-06-03T11:06:44+08:00">

		<div class="page__inner-wrap">
			
				<header>
					<h1 id="page-title" class="page__title" itemprop="headline">Localisation
</h1>
					


				</header>
			

			<section class="page__content" itemprop="text">
				
					<aside class="sidebar__right sticky">
						<nav class="toc">
							<header><h4 class="nav__title"><i class="fas fa-map-marker-alt"></i> Localisation</h4></header>
							<ul class="toc__menu">
  <li><a href="#camera">Camera</a>
    <ul>
      <li><a href="#position">Position</a></li>
      <li><a href="#orientation">Orientation</a></li>
      <li><a href="#other-landmarks">Other Landmarks</a></li>
    </ul>
  </li>
  <li><a href="#light-sensor">Light Sensor</a></li>
  <li><a href="#tof">TOF</a></li>
  <li><a href="#localisation-demos">Localisation Demos</a></li>
</ul>

						</nav>
					</aside>
				
				<p>We have came up with a method for finding the position and orientation of the robot using purely the camera, which we also use to be able to face “straight” forward.</p>

<h2 id="camera">Camera</h2>

<p>There are usually two big issues when it comes to camera localisation:</p>

<ol>
  <li>Inaccuracy: Due to noise from the camera’s image, the areas detected as objects are constantly changing, which would change the distance measurements (from our testing, the angle remains quite stable). Besides, the further away an object is, the more stretching (distortion) would occur to its image on the mirror. Hence, any small fluctuations in the object’s position could cause large distance changes on the image.</li>
  <li>Lack of reliabilty: The field is often crowded with many robots which would severely limit the robot’s field of view. This prevents the robot from being able to constantly see the landmarks it needs to calculate its position.</li>
</ol>

<p>However, our method has proven to be rather successful in circumventing these problems. Note that our “localisation” algorithm finds the vector from the robot to a specific point on the field, not necessarily finding out the current position of the robot (since localisation is, more often than not, simply used to find out where to move to reach a desired destination).</p>

<h3 id="position">Position</h3>

<p>At first glance, it might seem logical to simply form the vectors from the robot to the 2 goals, and since we know the real-life positions of the 2 goals relative to each other, it would thus be possible to triangulate the robot’s position relative to the 2 goals. However, due to the inaccurate distance measurements as stated in point 1 above, this would not yield good results, since it relies on the camera measurements matching up to the real distance of the goals.</p>

<p>Hence, our method avoids absolute distances completely by first finding the relative centre between the 2 goals. In the diagram below, we see that given yellow vector <em>CB</em> and blue vector <em>CD</em>, their vector sum adds up to <em>CE</em>, for which halving its magnitude would create vector <em>CA</em> that points directly to the centre point. The benefit of finding the centre point first is that it’s a relative reference point i.e. positions on the field will be based on this reference point, but its a relative point between the 2 goals rather than a “fixed” point based on knowledge of absolute distances.</p>

<p>Once we know the centre point, we can find vector <em>AB = CB - CA</em>. Vector <em>AB</em> is very important as this represents the vector that tells us the direction of where the front of the field is (assuming facing the yellow goal is the “front” position).</p>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/strat-local-1.jpg" alt="Finding centre point" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Finding centre point

      
    </figcaption>
  
</figure>

<p>Now, let’s say we want to move to point F. We already know the angle of vector <em>AF</em> relative to vector <em>AB</em>, since angles are quite accurate and “real-life” values can be used. For the magnitude of <em>AF</em>, we know the real-life ratio of its length relative to the distance between the 2 goals. Using this ratio, we multiply it by the total goal distance <em>BD</em>, to give us the relative length of <em>AF</em>! And just like that, the vector from the robot to the point is simply <em>CF = CA + AF</em>!</p>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/strat-local-2.jpg" alt="Finding vector CF" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Finding vector <em>CF</em>

      
    </figcaption>
  
</figure>

<p>To show that this method is resilient to “false” distance measurements, the diagram below shows a scenario where the robot detects the correct blue goal angle, but its distance is detected at around 2/3 of the actual distance (note that in reality, our maximum deviation is only around 75% of the actual distance when the robot is furthest away from the goal).</p>

<p>The diagram is drawn to scale (in Fusion 360) and the first circle to the left, shows the real position of point F, while the circle more to the right shows the calculated position of point F. Even with a theoretical 33% measurement error, the final calculated position is only slightly deviated away from the real position, nowhere near significant to negatively affect the robot’s performance.</p>

<figure class="single ">
  
    
      <a href="/assets/images/strat-local-3.jpg" title="Calculations are resilient to false measurements">
          <img loading="lazy" src="/assets/images/strat-local-3.jpg" alt="Resilient to false reading" />
      </a>
    
  
  
    <figcaption>Calculations are resilient to false measurements
</figcaption>
  
</figure>

<h3 id="orientation">Orientation</h3>

<p>In order to find out our orientation, we simply take reference to vector <em>AB</em>. Since the information regarding landmarks are all in polar form (angle and distance), we work with all our vectors in polar form as well. Hence, the angle of vector <em>AB</em> is simply the current orientation of the robot. By applying an angular velocity that is proportional to the angle of vector <em>AB</em>, the robot can be made to face straight forward.</p>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/strat-local-4.jpg" alt="Orientating to vector AB" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Orientating to vector <em>AB</em>

      
    </figcaption>
  
</figure>

<p>To orientate towards the blue goal as the “front” instead, we can just reference to vector <em>AD</em> instead.</p>

<h3 id="other-landmarks">Other Landmarks</h3>

<p>To further improve this, we can use the entire field instead. We are currently able to detect the entire field by tracking all that is green and drawing a “best-fit rectangle” around it. Simply looking at the angle of this rectangle relative to the front of the robot can easily tell us our heading. We did not have enough time to fully look into the feasibility of this, but it is definitely something we will try in the near future.</p>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/strat-local-5.jpg" alt="Field tracking" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Field tracking

      
    </figcaption>
  
</figure>

<h2 id="light-sensor">Light Sensor</h2>

<p>While the line is not the most useful landmark on the field, it is the most trustable landmark since its detected by the light sensors which have virtually no chance of being interfered with.</p>

<p>When the desired point to travel to lies on a line, the robot not only travels in the vector to that point, but also does line tracking based on that vector, to reach the point with greater accuracy.</p>

<p>In addition, for edge cases where the robot is on a line and is unable to use any of the camera’s landmarks for orientation, it can simply orientate itself to be parallel with the line in order to face straight forward.</p>

<h2 id="tof">TOF</h2>

<p>Coming eventually, maybe never, definitely not soon, but probably maybe…</p>

<h2 id="localisation-demos">Localisation Demos</h2>

<iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/uwvPuR9AYmc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<iframe loading="lazy" width="560" height="315" src="https://www.youtube.com/embed/3ExjoEmAOgY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

				
			</section>

			<footer class="page__meta">
				
				


				<p class="page__date">
	<i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>
	
		<strong>Updated:</strong>
		<time datetime="2021-06-03">June 3, 2021</time>
	
</p>

			</footer>

			

			
  <nav class="pagination">
    
      <a href="/open/strat/defence/" class="pagination--pager" title="Defence Strategy
">Previous</a>
    
    
      <a href="/open/strat/line/" class="pagination--pager" title="Line Control
">Next</a>
    
  </nav>

		</div>

		
	</article>

	
	
</div>

		</div>

		
			<div class="search-content">
				<div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

			</div>
		

		<div id="footer" class="page__footer">
			<footer>
				<!-- start custom footer snippets -->

<!-- end custom footer snippets -->
				<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter" style="color:white" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/Bozotics-113608380186713" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook" style="color:white" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" style="color:white" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" style="color:white" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" style="color:white" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Transcendence. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

			</footer>
		</div>

		
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166112888-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166112888-1', { 'anonymize_ip': false});
</script>









		<aside class="sidebar__top" id="topButton">
			<a href="#top"><i class="fas fa-angle-double-up fa-2x"></i></a>
		</aside>
		<script>
		/* When the user scrolls down 100px from the top of the document, show the button */
		$(window).scroll(function() {
			if ($(this).scrollTop() >= 100) {
				$("#topButton").fadeIn(200);
			} else {
				$("#topButton").fadeOut(200);
			}
		});
		</script>

	</body>
</html>

