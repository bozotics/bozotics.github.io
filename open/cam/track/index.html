<!doctype html>
<!--
	Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
	Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
	Free for personal and commercial use under the MIT license
	https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
	<head>
		<meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Tracking Algorithm | Transcendence</title>
<meta name="description" content="Overview">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Transcendence">
<meta property="og:title" content="Tracking Algorithm">
<meta property="og:url" content="https://bozo.infocommsociety.com/open/cam/track/">


  <meta property="og:description" content="Overview">







  <meta property="article:published_time" content="2020-05-02T08:00:00+08:00">



  <meta property="article:modified_time" content="2021-05-22T16:01:10+08:00">




<link rel="canonical" href="https://bozo.infocommsociety.com/open/cam/track/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://bozo.infocommsociety.com/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Transcendence Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


		<!-- start custom head snippets -->











<style>
    ul.visible-links li.masthead__menu-item a[href="/open/intro/"]:before {
        transform: scaleX(1);
    }

    ul.hidden-links li.masthead__menu-item a[href="/open/intro/"] {
        color: #fff;
        background: #0092ca;
    }
</style>





<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" href="/assets/images/eagle ver 2.1.3.1-lowres.jpg">

<!-- end custom head snippets -->
	</head>

	<body class="layout--single">
		<nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

		<!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

		

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img loading="lazy" src="/assets/images/eagle%20ver%202.1.3.1-transparent-lowres.png" alt="Transcendence"></a>
        
        <a class="site-title" href="/">
          Transcendence
          <span class="site-subtitle">The fine line between innovation and insanity</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/open/intro/">Open</a>
            </li><li class="masthead__menu-item">
              <a href="/lightweight/intro/">Lightweight</a>
            </li><li class="masthead__menu-item">
              <a href="/rescue/intro/">Rescue</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/">Blog</a>
            </li><li class="masthead__menu-item">
              <a href="/contact/">Contact</a>
            </li><li class="masthead__menu-item">
              <a href="/resources/">Resources</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


		<div class="initial-content">
			



<div id="main" role="main">
	
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <a href="/open/intro/"><span class="nav__sub-title">Introduction</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/open/mech/"><span class="nav__sub-title">Mechanical</span></a>
        

        
        <ul>
          
            <li><a href="/open/mech/general/">General Info</a></li>
          
            <li><a href="/open/mech/drive/">Drive System</a></li>
          
            <li><a href="/open/mech/mirror/">Mirror</a></li>
          
            <li><a href="/open/mech/dribbler/">Dribbler</a></li>
          
            <li><a href="/open/mech/assorted/">Assorted Parts</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/elec/"><span class="nav__sub-title">Electronics</span></a>
        

        
        <ul>
          
            <li><a href="/open/elec/design/">Design</a></li>
          
            <li><a href="/open/elec/selection/">Selection Process</a></li>
          
            <li><a href="/open/elec/components/">Components</a></li>
          
            <li><a href="/open/elec/circuits/">Circuits</a></li>
          
            <li><a href="/open/elec/history/">History</a></li>
          
            <li><a href="/open/elec/soldering/">Soldering</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/cam/"><span class="nav__sub-title">Camera</span></a>
        

        
        <ul>
          
            <li><a href="/open/cam/general/">General Info</a></li>
          
            <li><a href="/open/cam/track/" class="active">Tracking Algorithm</a></li>
          
            <li><a href="/open/cam/gui/">GUI</a></li>
          
            <li><a href="/open/cam/communication/">Communication</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/strat/"><span class="nav__sub-title">Strategy</span></a>
        

        
        <ul>
          
            <li><a href="/open/strat/attack/">Attack Strategy</a></li>
          
            <li><a href="/open/strat/defence/">Defence Strategy</a></li>
          
            <li><a href="/open/strat/localisation/">Localisation</a></li>
          
            <li><a href="/open/strat/line/">Line Control</a></li>
          
            <li><a href="/open/strat/state/">State Switching</a></li>
          
            <li><a href="/open/strat/simluation/">Simulation</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <a href="/open/debug/"><span class="nav__sub-title">Debugging</span></a>
        

        
      </li>
    
      <li>
        
          <a href="/open/afi/"><span class="nav__sub-title">AFI</span></a>
        

        
      </li>
    
  </ul>
</nav>

    
  
  </div>



	<article class="page" itemscope itemtype="https://schema.org/CreativeWork">
		<meta itemprop="headline" content="Tracking Algorithm">
		<meta itemprop="description" content="Overview">
		<meta itemprop="datePublished" content="2020-05-02T08:00:00+08:00">
		<meta itemprop="dateModified" content="2021-05-22T16:01:10+08:00">

		<div class="page__inner-wrap">
			
				<header>
					<h1 id="page-title" class="page__title" itemprop="headline">Tracking Algorithm
</h1>
					


				</header>
			

			<section class="page__content" itemprop="text">
				
					<aside class="sidebar__right sticky">
						<nav class="toc">
							<header><h4 class="nav__title"><i class="fas fa-camera"></i> Tracking Algorithm</h4></header>
							<ul class="toc__menu">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#tracking">Tracking</a>
    <ul>
      <li><a href="#considerations">Considerations</a>
        <ul>
          <li><a href="#speed--latency">Speed &amp; Latency</a></li>
          <li><a href="#accuracy--reliability">Accuracy &amp; Reliability</a></li>
        </ul>
      </li>
      <li><a href="#algorithms">Algorithms</a>
        <ul>
          <li><a href="#circular-buffer">Circular buffer</a></li>
          <li><a href="#image-processing">Image Processing</a></li>
          <li><a href="#kalman-filter">Kalman Filter</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#threading">Threading</a>
    <ul>
      <li><a href="#precautions">Precautions</a></li>
      <li><a href="#dynamic-priority">Dynamic priority</a></li>
    </ul>
  </li>
</ul>

						</nav>
					</aside>
				
				<h2 id="overview">Overview</h2>

<p>The camera program is written in C++. It is separated into two sections, the main processing and debugging. These two sections can be found in <a href="https://github.com/bozotics/GUI/blob/master/cache/current/camera.cpp">camera.cpp</a> and <a href="https://github.com/bozotics/GUI/blob/master/cache/current/debug.cpp">debug.cpp</a> respectively. Calibration values can be found in <a href="https://github.com/bozotics/GUI/blob/master/cache/current/config.txt">config.txt</a> which can be edited without recompiling the program.</p>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/program_flowchart.png" alt="Main Program Flowchart" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Flowchart of the program

      
    </figcaption>
  
</figure>

<p>Our program will launch on startup and enter either competition or debug mode upon selection by the user. The code behind the tracking program will be explained in this article while debugging will be covered under GUI (next article).</p>

<h2 id="tracking">Tracking</h2>

<h3 id="considerations">Considerations</h3>

<p>Speed and latency as well as accuracy and reliability were some considerations while we coded our tracking program.</p>

<h4 id="speed--latency">Speed &amp; Latency</h4>

<p>We wanted a program which could track objects <strong>above 60 FPS</strong> with <strong>minimal latency</strong>. Since our robot is moving at high speeds throughout the game, it is important to have high refresh rates so that the movement of the robot will be fluid. It is also essential for the robot to have minimal latency to avoid low responsiveness and overshooting the ball while tracking it. From past yearâ€™s experience, our robot would overshoot while moving towards the ball which could be explained by the low FPS and high latency of the program as we were using python back then.</p>

<h4 id="accuracy--reliability">Accuracy &amp; Reliability</h4>

<p>We also wanted a program which can track the objects on the field accurately while doing so reliably. Given that we are using an omnidirectional mirror, the images captured will be distorted and minimised. Furthermore, our mirror is not completely smooth, thus the image will be slightly blurred. To compensate for these problems arising from the choice of an omnidirectional mirror, we had to create a program which has high accuracy and reliability at detecting objects. Moreover, we had to discern between the objects in the field and unwanted objects outside of the field accurately to prevent detecting false positives.</p>

<h3 id="algorithms">Algorithms</h3>

<p>We used several algorithms and techniques to fulfill the considerations we had.</p>

<h4 id="circular-buffer">Circular buffer</h4>

<p>To avoid race conditions where one thread is reading the image while another is writing into the same image array, we implemented the circular buffer. With the circular buffer, each thread is not hindered by another thread while trying to access information. As such, race conditions can be prevented and our program is more efficient.</p>

<h4 id="image-processing">Image Processing</h4>

<figure style="margin-left:auto;margin-right:auto;">
  
  <img loading="lazy" src="/assets/images/image_processing.png" alt="Image Processing Flowchart" style="margin-left:auto;margin-right:auto;" />
  
  
    <figcaption>
      
      Image Processing Flowchart

      
    </figcaption>
  
</figure>

<h4 id="kalman-filter">Kalman Filter</h4>

<p>In order to provide an accurate prediction of the ball in situations where it is obscured by other elements on the field, we employed the kalman filter. With the kalman filter, we can have a better idea of where the ball was based on the trajectory of the ball. However, due to the non-linear nature of the image from our curved mirror, we mapped the ball from the image to real world coordinates before applying the kalman filter. This way, the kalman filter is applied effectively.</p>

<h2 id="threading">Threading</h2>

<p>Since we are tracking multiple different objects on the field, ball, goals, area of the field, we utilised threading to improve the performance of our program.</p>

<h3 id="precautions">Precautions</h3>

<p>The most common issue with threading is race condition where a variable is accessed while it is being edited, corrupting the data. Hence, we took extra precautions in our program to prevent this fatal error. Through the use of the atomic variables and locks, we created a program free of race conditions. Another precaution we took was the possibility of locks decreasing the performance of our program. We minimise the impacts of locks on our program by implementing the circular buffer as described above.</p>

<h3 id="dynamic-priority">Dynamic priority</h3>

<p>Keeping in mind not all the elements need to be tracked at the highest frame rate possible all the time, we effectively allocate the available computing resources with dynamic priority implementation. Priorities for different objects can be controlled by the main microcontroller. For example, if the robot is not in possession of the ball, it will run the ball tracking thread at the highest possible performance while other elements like the field and the goals can be placed at a lower priority.</p>


				
			</section>

			<footer class="page__meta">
				
				


				<p class="page__date">
	<i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i>
	
		<strong>Updated:</strong>
		<time datetime="2021-05-22">May 22, 2021</time>
	
</p>

			</footer>

			

			
  <nav class="pagination">
    
      <a href="/open/cam/general/" class="pagination--pager" title="General Information
">Previous</a>
    
    
      <a href="/open/cam/gui/" class="pagination--pager" title="Graphical User Interface
">Next</a>
    
  </nav>

		</div>

		
	</article>

	
	
</div>

		</div>

		
			<div class="search-content">
				<div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

			</div>
		

		<div id="footer" class="page__footer">
			<footer>
				<!-- start custom footer snippets -->

<!-- end custom footer snippets -->
				<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter" style="color:white" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/Bozotics-113608380186713" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook" style="color:white" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" style="color:white" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
          <li><a href="https://instagram.com/bozotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" style="color:white" aria-hidden="true"></i> Instagram</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" style="color:white" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Transcendence. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

			</footer>
		</div>

		
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166112888-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166112888-1', { 'anonymize_ip': false});
</script>









		<aside class="sidebar__top" id="topButton">
			<a href="#top"><i class="fas fa-angle-double-up fa-2x"></i></a>
		</aside>
		<script>
		/* When the user scrolls down 100px from the top of the document, show the button */
		$(window).scroll(function() {
			if ($(this).scrollTop() >= 100) {
				$("#topButton").fadeIn(200);
			} else {
				$("#topButton").fadeOut(200);
			}
		});
		</script>

	</body>
</html>

